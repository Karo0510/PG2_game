<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <canvas id="myCanvas" width="800" height="600" style="border:1px solid #d3d3d3;">
        Your browser does not support the HTML5 canvas tag.</canvas>
        <script>

            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");

            CirclesArray = [];

            class Rectangle
            {
                constructor(x, y, dx, x_size, y_size)
                {
                    this.x = x;
                    this.y = y;
                    this.dx = dx;
                    this.x_size = x_size;
                    this.y_size = y_size;
                }

                drawRectangle()
                { 
                    console.log(this.x+" "+this.y);
                    ctx.beginPath();
                    ctx.rect(this.x, this.y-this.y_size, this.x_size, this.y_size);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.stroke();
                }
            }

            class Circles
            {
                constructor(x, y, r, dy)
                {
                    this.x = x;
                    this.y = y;
                    this.r = r;
                    this.dy = dy;
                }

                drawCircle()
                {
                    ctx.beginPath();
                    ctx.arc(this.x,this.y, this.r, 0, 2*Math.PI);
                    ctx.fillStyle = "black";
                    ctx.fill();
                    ctx.stroke();
                }

                moveCircle()
                {
                    this.drawCircle();
                    if (this.y + this.r < 0.75*h)
                    {
                        this.y += this.dy;
                    }
                    else
                    {
                        this.dy = 0;
                    }
                }


               
            }
            const w = 800;
            const h = 600;

            rightPressed = false;
            leftPressed = false;

            var r = new Rectangle(0, 600, 10, 50, 50);

            function addCircle()
            {
                x = Math.floor(Math.random()*(w-20));
                var c = new Circles(x, 20, 20, 5);
                CirclesArray.push(c);
                console.log(CirclesArray);

            }

            setInterval(addCircle, 1000);

            function updateCircles()
            {
                for (var i = 0; i<CirclesArray.length; i++)
                {
                    CirclesArray[i].moveCircle();
                }
            }


            /*function animate()
            {
                clear();
                updateCircles();
            }
            setInterval(animate, 100);*/

            function clear()
            {
                ctx.fillStyle = "white";
                ctx.fillRect(0, 0, w, h);
                ctx.fill();   
            }
   

            function move()
            {
                if (rightPressed)
                {
                    r.x += r.dx;

                    if ((r.x + r.x_size  > w))
                    {
                        r.x = w-r.x_size;
                    }
                }else if (leftPressed)
                {
                    r.x -= r.dx;

                    if (r.x <= 0)
                    {
                        r.x = 0;
                    }
                }
                
            }

            function pressKey(e)
            {
                if (e.key == "ArrowRight")
                {
                    rightPressed = true;
                    //leftPressed = false;
                }
                
                if (e.key == "ArrowLeft")
                {
                    leftPressed = true;
                    //rightPressed = false;
                }
                console.log(rightPressed);
            }

            function releaseKey(e)
            {
                if(e.key == "ArrowRight") 
                {
                    rightPressed = false;
                }
                else if(e.key == "ArrowLeft") 
                {
                    leftPressed = false;
                }
            }

            document.addEventListener("keydown", pressKey, false);
            document.addEventListener("keyup", releaseKey, false);

            function animate()
            {
                move();
                clear();
                r.drawRectangle();  
                updateCircles()

            }

            setInterval(function() {animate()}, 10);
       
        </script> 
    
</body>
</html>